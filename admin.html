<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Editor de Produto</title>
<style>
  :root{--card-bg:#fff;--accent:#3483fa;--whatsapp:#25D366}
  body{font-family:Arial, sans-serif;background:#f5f5f5;padding:20px}
  .page{max-width:900px;margin:0 auto;display:grid;grid-template-columns:1fr 1fr;gap:20px}
  .card{background:var(--card-bg);padding:18px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
  h1{font-size:20px;margin:0 0 12px;color:#222}
  label{display:block;font-size:13px;color:#333;margin:10px 0 6px}
  input[type="text"], input[type="number"], textarea, select{
    width:100%;padding:10px;border:1px solid #ddd;border-radius:8px;font-size:14px;box-sizing:border-box;
  }
  textarea{min-height:90px;resize:vertical}
  .row{display:flex;gap:10px;align-items:center}
  .radio-group, .select-group{display:flex;gap:8px}
  .option-btn{padding:8px 12px;border-radius:8px;border:1px solid #ddd;background:#fafafa;cursor:pointer;user-select:none}
  .option-btn.active{background:var(--accent);color:#fff;border-color:rgba(0,0,0,0.08)}
  .img-preview{width:100%;height:220px;background:#f0f0f0;border-radius:8px;display:flex;align-items:center;justify-content:center;overflow:hidden}
  .img-preview img{width:100%;height:100%;object-fit:cover;display:block}
  .actions{display:flex;gap:10px;margin-top:12px}
  button{padding:10px 14px;border-radius:8px;border:none;cursor:pointer;font-weight:600}
  .btn-save{background:var(--accent);color:#fff}
  .btn-clear{background:#eee}
  .btn-whatsapp{background:var(--whatsapp);color:#fff;display:inline-flex;align-items:center;gap:8px}
  .small{font-size:12px;color:#666;margin-top:6px}
  pre{background:#f0f0f0;padding:12px;border-radius:8px;overflow-x:auto;margin-top:12px;font-size:13px;}
  @media (max-width:820px){.page{grid-template-columns:1fr}}
</style>
</head>
<body>

<div class="page">
  <!-- FormulÃ¡rio de ediÃ§Ã£o -->
  <div class="card">
    <h1>Editar produto</h1>

    <label for="inputImage">Imagem do produto</label>
    <div class="img-preview" id="imgPreview">Nenhuma imagem</div>
    <input type="file" id="inputImage" accept="image/*" style="margin-top:8px" />

    <label for="inputName">Nome</label>
    <input type="text" id="inputName" placeholder="Ex: Pneu Aro 15" />

    <label for="inputPrice">PreÃ§o (R$)</label>
    <input type="number" id="inputPrice" placeholder="Ex: 299.90" step="0.01" min="0" />

    <label for="inputDescription">DescriÃ§Ã£o</label>
    <textarea id="inputDescription" placeholder="DescriÃ§Ã£o do produto"></textarea>

    <label>Tipo de compra</label>
    <div class="select-group" id="tipoCompra">
      <div class="option-btn" data-value="Varejo">Varejo</div>
      <div class="option-btn" data-value="Atacado">Atacado</div>
    </div>

    <label>CondiÃ§Ã£o do pneu</label>
    <div class="select-group" id="condicaoPneu">
      <div class="option-btn" data-value="Novo">Novo</div>
      <div class="option-btn" data-value="Meia vida">Meia vida</div>
    </div>

    <label style="margin-top:10px"><input type="checkbox" id="inmetroCheck" /> &nbsp; Possui selo INMETRO (se aplicÃ¡vel)</label>
    <div class="small">Marque apenas se o pneu for remoldado/recapado com certificaÃ§Ã£o.</div>

    <div class="actions">
      <button class="btn-save" id="saveBtn">Salvar produto (local)</button>
      <button class="btn-clear" id="clearBtn">Limpar</button>
    </div>
  </div>

  <!-- PrÃ©-visualizaÃ§Ã£o do produto -->
  <div class="card" id="productCard">
    <h1>PrÃ©-visualizaÃ§Ã£o</h1>
    <div id="productContainer">
      <div class="img-preview" id="productImgPreview">Nenhum produto selecionado</div>
      <h2 id="prodName" style="margin:12px 0 6px;color:#222">â€”</h2>
      <div id="prodPrice" style="font-weight:700;color:#111">â€”</div>
      <p id="prodDesc" style="color:#444">â€”</p>

      <p class="small"><strong>Tipo:</strong> <span id="prodTipo">â€”</span></p>
      <p class="small"><strong>CondiÃ§Ã£o:</strong> <span id="prodCond">â€”</span> <span id="prodInmetro"></span></p>

      <div style="margin-top:14px">
        <button id="whatsappBtn" class="btn-whatsapp">ðŸ’¬ Abrir WhatsApp</button>
      </div>
    </div>

    <!-- JSON em tempo real -->
    <h3 style="margin-top:20px">JSON do produto:</h3>
    <pre id="jsonOutput">Nenhum produto selecionado.</pre>
  </div>
</div>

<script>
  const inputImage = document.getElementById('inputImage');
  const imgPreview = document.getElementById('imgPreview');
  const productImgPreview = document.getElementById('productImgPreview');
  const inputName = document.getElementById('inputName');
  const inputPrice = document.getElementById('inputPrice');
  const inputDescription = document.getElementById('inputDescription');
  const tipoCompraDiv = document.getElementById('tipoCompra');
  const condicaoPneuDiv = document.getElementById('condicaoPneu');
  const inmetroCheck = document.getElementById('inmetroCheck');
  const saveBtn = document.getElementById('saveBtn');
  const clearBtn = document.getElementById('clearBtn');
  const whatsappBtn = document.getElementById('whatsappBtn');
  const jsonOutput = document.getElementById('jsonOutput');

  const prodName = document.getElementById('prodName');
  const prodPrice = document.getElementById('prodPrice');
  const prodDesc = document.getElementById('prodDesc');
  const prodTipo = document.getElementById('prodTipo');
  const prodCond = document.getElementById('prodCond');
  const prodInmetro = document.getElementById('prodInmetro');

  let currentImageDataUrl = null;

  // NÃºmero WhatsApp (troque pelo seu)
  const phoneNumber = "SEUNUMERO";

  function setActiveOption(groupEl, value){
    groupEl.querySelectorAll('.option-btn').forEach(b=>{
      b.classList.toggle('active', b.dataset.value === value);
    });
  }
  function getActiveOption(groupEl){
    return groupEl.querySelector('.option-btn.active')?.dataset.value || null;
  }

  document.querySelectorAll('.select-group').forEach(group=>{
    group.addEventListener('click', (e)=>{
      const btn = e.target.closest('.option-btn');
      if(!btn) return;
      group.querySelectorAll('.option-btn').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      updatePreviewAndJSON();
    });
  });

  inputImage.addEventListener('change', (e)=>{
    const file = e.target.files[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = function(ev){
      currentImageDataUrl = ev.target.result;
      imgPreview.innerHTML = `<img src="${currentImageDataUrl}" alt="Imagem" />`;
      productImgPreview.innerHTML = `<img src="${currentImageDataUrl}" alt="Imagem do produto" />`;
      updatePreviewAndJSON();
    };
    reader.readAsDataURL(file);
  });

  function getProductData(){
    return {
      name: inputName.value.trim() || "â€”",
      price: inputPrice.value ? Number(inputPrice.value).toFixed(2) : "â€”",
      description: inputDescription.value.trim() || "â€”",
      tipo: getActiveOption(tipoCompraDiv) || "â€”",
      condicao: getActiveOption(condicaoPneuDiv) || "â€”",
      inmetro: inmetroCheck.checked,
      img: currentImageDataUrl || ""
    };
  }

  function updatePreviewAndJSON(){
    const product = getProductData();
    productImgPreview.innerHTML = product.img ? `<img src="${product.img}" alt="${product.name}" />` : "Nenhuma imagem";
    prodName.textContent = product.name;
    prodPrice.textContent = product.price !== "â€”" ? `R$ ${product.price}` : "â€”";
    prodDesc.textContent = product.description;
    prodTipo.textContent = product.tipo;
    prodCond.textContent = product.condicao;
    prodInmetro.textContent = product.inmetro ? " â€¢ Possui selo INMETRO" : "";
    jsonOutput.textContent = JSON.stringify(product, null, 2);
  }

  // Atualiza live quando campos de texto mudam
  [inputName, inputPrice, inputDescription].forEach(el=>{
    el.addEventListener('input', updatePreviewAndJSON);
  });
  inmetroCheck.addEventListener('change', updatePreviewAndJSON);

  saveBtn.addEventListener('click', ()=>{
    const product = getProductData();
    localStorage.setItem('selectedProduct', JSON.stringify(product));
    alert('Produto salvo localmente!');
  });

  clearBtn.addEventListener('click', ()=>{
    if(!confirm('Limpar formulÃ¡rio e remover produto salvo?')) return;
    localStorage.removeItem('selectedProduct');
    currentImageDataUrl = null;
    inputImage.value = "";
    inputName.value = "";
    inputPrice.value = "";
    inputDescription.value = "";
    inmetroCheck.checked = false;
    setActiveOption(tipoCompraDiv,null);
    setActiveOption(condicaoPneuDiv,null);
    updatePreviewAndJSON();
  });

  whatsappBtn.addEventListener('click', ()=>{
    const product = getProductData();
    const message = `OlÃ¡! Tenho interesse no produto: ${product.name}\nPreÃ§o: ${product.price}\nTipo: ${product.tipo}\nCondiÃ§Ã£o: ${product.condicao}${product.inmetro ? ' (possui selo INMETRO)' : ''}\n\n${product.description}`;
    const link = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;
    window.open(link,'_blank');
  });

  // Carregar produto salvo
  window.addEventListener('load', ()=>{
    const saved = JSON.parse(localStorage.getItem('selectedProduct'));
    if(saved){
      inputName.value = saved.name || "";
      inputPrice.value = saved.price || "";
      inputDescription.value = saved.description || "";
      setActiveOption(tipoCompraDiv, saved.tipo || null);
      setActiveOption(condicaoPneuDiv, saved.condicao || null);
      inmetroCheck.checked = !!saved.inmetro;
      if(saved.img){
        currentImageDataUrl = saved.img;
        imgPreview.innerHTML = `<img src="${saved.img}" alt="Imagem" />`;
      }
      updatePreviewAndJSON();
    } else {
      updatePreviewAndJSON();
    }
  });
</script>

</body>
</html>
