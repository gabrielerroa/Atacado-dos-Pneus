<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Editor de Produto</title>
<style>
  :root{--card-bg:#fff;--accent:#3483fa;--whatsapp:#25D366}
  body{font-family:Arial, sans-serif;background:#f5f5f5;padding:20px}
  .page{max-width:900px;margin:0 auto;display:grid;grid-template-columns:1fr 1fr;gap:20px}
  .card{background:var(--card-bg);padding:18px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
  h1{font-size:20px;margin:0 0 12px;color:#222}
  label{display:block;font-size:13px;color:#333;margin:10px 0 6px}
  input[type="text"], input[type="number"], textarea{
    width:100%;padding:10px;border:1px solid #ddd;border-radius:8px;font-size:14px;box-sizing:border-box;
  }
  textarea{min-height:90px;resize:vertical}
  .option-item{display:flex;align-items:center;gap:10px;margin-top:8px}
  .option-item input[type="text"]{flex:2}
  .option-item input[type="number"]{flex:1}
  .option-item button{background:#ff4d4d;color:#fff;border:none;padding:6px 10px;border-radius:6px;cursor:pointer}
  .option-item button:hover{background:#d93c3c}
  .add-option{background:#eee;border:none;padding:8px 12px;border-radius:8px;cursor:pointer;margin-top:8px}
  .img-preview{width:100%;height:220px;background:#f0f0f0;border-radius:8px;display:flex;align-items:center;justify-content:center;overflow:hidden}
  .img-preview img{width:100%;height:100%;object-fit:cover;display:block}
  .actions{display:flex;gap:10px;margin-top:12px}
  button{padding:10px 14px;border-radius:8px;border:none;cursor:pointer;font-weight:600}
  .btn-save{background:var(--accent);color:#fff}
  .btn-clear{background:#eee}
  .btn-whatsapp{background:var(--whatsapp);color:#fff;display:inline-flex;align-items:center;gap:8px}
  .small{font-size:12px;color:#666;margin-top:6px}
  pre{background:#f0f0f0;padding:12px;border-radius:8px;overflow-x:auto;margin-top:12px;font-size:13px;}
  @media (max-width:820px){.page{grid-template-columns:1fr}}
</style>
</head>
<body>

<div class="page">
  <!-- FormulÃ¡rio -->
  <div class="card">
    <h1>Editar produto</h1>

    <label>Imagem do produto</label>
    <div class="img-preview" id="imgPreview">Nenhuma imagem</div>
    <input type="file" id="inputImage" accept="image/*" style="margin-top:8px" />

    <label>Nome</label>
    <input type="text" id="inputName" placeholder="Ex: Pneu Aro 15" />

    <label>PreÃ§o (R$)</label>
    <input type="number" id="inputPrice" placeholder="Ex: 299.90" step="0.01" min="0" />

    <label>DescriÃ§Ã£o</label>
    <textarea id="inputDescription" placeholder="DescriÃ§Ã£o do produto"></textarea>

    <label>OpÃ§Ãµes e Quantidades</label>
    <div id="optionsContainer"></div>
    <button class="add-option" id="addOptionBtn">+ Adicionar opÃ§Ã£o</button>

    <label>CondiÃ§Ã£o do pneu</label>
    <div>
      <div class="option-btn active" id="condicaoFixa">Meia vida</div>
    </div>

    <div class="actions">
      <button class="btn-save" id="saveBtn">Salvar produto</button>
      <button class="btn-clear" id="clearBtn">Limpar</button>
    </div>
  </div>

  <!-- PrÃ©-visualizaÃ§Ã£o -->
  <div class="card" id="productCard">
    <h1>PrÃ©-visualizaÃ§Ã£o</h1>
    <div id="productContainer">
      <div class="img-preview" id="productImgPreview">Nenhum produto selecionado</div>
      <h2 id="prodName" style="margin:12px 0 6px;color:#222">â€”</h2>
      <div id="prodPrice" style="font-weight:700;color:#111">â€”</div>
      <p id="prodDesc" style="color:#444">â€”</p>
      <p class="small"><strong>CondiÃ§Ã£o:</strong> Meia vida</p>
      <ul id="prodOptions" style="margin-top:8px;font-size:13px;color:#333;padding-left:18px"></ul>
      <div style="margin-top:14px">
        <button id="whatsappBtn" class="btn-whatsapp">ðŸ’¬ Abrir WhatsApp</button>
      </div>
    </div>

    <h3 style="margin-top:20px">JSON do produto:</h3>
    <pre id="jsonOutput">Nenhum produto selecionado.</pre>
  </div>
</div>

<script>
  const inputImage = document.getElementById('inputImage');
  const imgPreview = document.getElementById('imgPreview');
  const productImgPreview = document.getElementById('productImgPreview');
  const inputName = document.getElementById('inputName');
  const inputPrice = document.getElementById('inputPrice');
  const inputDescription = document.getElementById('inputDescription');
  const addOptionBtn = document.getElementById('addOptionBtn');
  const optionsContainer = document.getElementById('optionsContainer');
  const saveBtn = document.getElementById('saveBtn');
  const clearBtn = document.getElementById('clearBtn');
  const whatsappBtn = document.getElementById('whatsappBtn');
  const jsonOutput = document.getElementById('jsonOutput');
  const prodName = document.getElementById('prodName');
  const prodPrice = document.getElementById('prodPrice');
  const prodDesc = document.getElementById('prodDesc');
  const prodOptions = document.getElementById('prodOptions');

  let currentImageDataUrl = null;
  const phoneNumber = "SEUNUMERO";

  function addOption(name = "", qty = 1){
    const div = document.createElement('div');
    div.className = "option-item";
    div.innerHTML = `
      <input type="text" placeholder="Nome da opÃ§Ã£o" value="${name}">
      <input type="number" min="1" value="${qty}">
      <button>ðŸ—‘</button>
    `;
    div.querySelector('button').addEventListener('click', ()=>{ div.remove(); updatePreview(); });
    div.querySelectorAll('input').forEach(inp=>inp.addEventListener('input', updatePreview));
    optionsContainer.appendChild(div);
    updatePreview();
  }

  addOptionBtn.addEventListener('click', ()=>addOption());

  inputImage.addEventListener('change', (e)=>{
    const file = e.target.files[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = ev=>{
      currentImageDataUrl = ev.target.result;
      imgPreview.innerHTML = `<img src="${currentImageDataUrl}">`;
      productImgPreview.innerHTML = `<img src="${currentImageDataUrl}">`;
      updatePreview();
    };
    reader.readAsDataURL(file);
  });

  function getProductData(){
    const options = [...optionsContainer.querySelectorAll('.option-item')].map(div=>{
      const name = div.querySelector('input[type="text"]').value.trim();
      const qty = parseInt(div.querySelector('input[type="number"]').value);
      return name ? { nome:name, quantidade:qty } : null;
    }).filter(Boolean);
    return {
      name: inputName.value.trim() || "â€”",
      price: inputPrice.value ? Number(inputPrice.value).toFixed(2) : "â€”",
      description: inputDescription.value.trim() || "â€”",
      condicao: "Meia vida",
      options,
      img: currentImageDataUrl || ""
    };
  }

  function updatePreview(){
    const p = getProductData();
    productImgPreview.innerHTML = p.img ? `<img src="${p.img}">` : "Nenhuma imagem";
    prodName.textContent = p.name;
    prodPrice.textContent = p.price !== "â€”" ? `R$ ${p.price}` : "â€”";
    prodDesc.textContent = p.description;
    prodOptions.innerHTML = p.options.length ? p.options.map(o=>`<li>${o.nome} â€” ${o.quantidade} un.</li>`).join('') : "";
    jsonOutput.textContent = JSON.stringify(p, null, 2);
  }

  [inputName,inputPrice,inputDescription].forEach(el=>el.addEventListener('input',updatePreview));

  saveBtn.addEventListener('click',()=>{
    const product = getProductData();
    localStorage.setItem('selectedProduct', JSON.stringify(product));
    alert('Produto salvo!');
  });

  clearBtn.addEventListener('click',()=>{
    if(!confirm('Limpar tudo?'))return;
    localStorage.removeItem('selectedProduct');
    optionsContainer.innerHTML = "";
    inputName.value = "";
    inputPrice.value = "";
    inputDescription.value = "";
    currentImageDataUrl = null;
    imgPreview.textContent = "Nenhuma imagem";
    updatePreview();
  });

  whatsappBtn.addEventListener('click',()=>{
    const p = getProductData();
    const optionsText = p.options.map(o=>`${o.nome}: ${o.quantidade} un.`).join(", ");
    const message = `OlÃ¡! Tenho interesse no produto: ${p.name}\nPreÃ§o: R$ ${p.price}\nCondiÃ§Ã£o: ${p.condicao}\n${optionsText ? 'OpÃ§Ãµes: '+optionsText+'\n' : ''}\n${p.description}`;
    const link = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;
    window.open(link,'_blank');
  });

  window.addEventListener('load',()=>{
    const saved = JSON.parse(localStorage.getItem('selectedProduct'));
    if(saved){
      inputName.value = saved.name || "";
      inputPrice.value = saved.price || "";
      inputDescription.value = saved.description || "";
      if(saved.options){ saved.options.forEach(o=>addOption(o.nome,o.quantidade)); }
      if(saved.img){
        currentImageDataUrl = saved.img;
        imgPreview.innerHTML = `<img src="${saved.img}">`;
      }
    }
    updatePreview();
  });
</script>

</body>
</html>
