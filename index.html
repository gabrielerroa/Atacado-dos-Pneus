<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Atacadão Pneus</title>
<style>
/* Seu CSS original */
</style>
</head>
<body>

<header>
    <h1>Atacadão Pneus</h1>
    <div class="header-right">
        <input type="text" id="search" placeholder="Buscar produtos..." />
        <button class="search-btn" onclick="searchProducts()">Pesquisar</button>
        <button class="store-btn" onclick="showStore()">Entrar na Loja</button>
    </div>
</header>

<div class="intro" id="intro">
    <h2>Bem-vindo ao Atacadão Pneus!</h2>
    <p>Confira nossos pneus de qualidade, adicione produtos e compre facilmente.</p>
    <p>Use o botão acima para entrar na loja ou pesquise produtos abaixo.</p>
</div>

<div class="products" id="productList"></div>

<script>
let products = [];
const productList = document.getElementById('productList');

// Aqui coloque os nomes dos JSON que deseja carregar
const jsonFiles = ['produtos.json', 'oitos.json'];

function fetchProductsFromFile(fileName) {
  return fetch(fileName).then(res => {
    if (!res.ok) throw new Error(Erro ao carregar ${fileName});
    return res.json();
  });
}

function fetchAllProducts(callback) {
    const promises = jsonFiles.map(file => fetchProductsFromFile(file));
    Promise.all(promises)
      .then(results => {
        products = [].concat(...results);
        if(callback) callback();
      })
      .catch(error => console.error(error));
}

function displayProducts(items) {
    productList.style.display = 'flex';
    productList.innerHTML = '';
    items.forEach(p => {
        const productStr = JSON.stringify(p).replace(/"/g, '&quot;');
        productList.innerHTML += `
            <div class="product">
                <img src="${p.img}" alt="${p.name}" />
                <h3>${p.name}</h3>
                <p>${p.price}</p>
                <button onclick='viewProduct(JSON.parse("${productStr}"))'>Comprar</button>
            </div>
        `;
    });
}

function searchProducts() {
    if(products.length === 0) {
        fetchAllProducts(() => filterAndDisplay());
    } else {
        filterAndDisplay();
    }

    function filterAndDisplay() {
        const query = document.getElementById('search').value.toLowerCase();
        const filtered = products.filter(p => p.name.toLowerCase().includes(query));
        displayProducts(filtered);
        document.getElementById('intro').style.display = 'none';
    }
}

function viewProduct(product) {
    localStorage.setItem('selectedProduct', JSON.stringify(product));
    window.open('product.html', '_blank');
}

function showStore() {
    document.getElementById('intro').style.display = 'none';
    if(products.length === 0){
        fetchAllProducts(() => displayProducts(products));
    } else {
        displayProducts(products);
    }
}

// Descomente para carregar produtos automaticamente na abertura da página
// fetchAllProducts(() => displayProducts(products));
</script>

</body>
</html>
