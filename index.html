<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Editor de Produto</title>
<style>
  :root{--card-bg:#fff;--accent:#3483fa;--whatsapp:#25D366}
  body{font-family:Arial, sans-serif;background:#f5f5f5;padding:20px}
  .page{max-width:900px;margin:0 auto;display:grid;grid-template-columns:1fr 1fr;gap:20px}
  .card{background:var(--card-bg);padding:18px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
  h1{font-size:20px;margin:0 0 12px;color:#222}
  label{display:block;font-size:13px;color:#333;margin:10px 0 6px}
  input[type="text"], input[type="number"], textarea, select{
    width:100%;padding:10px;border:1px solid #ddd;border-radius:8px;font-size:14px;box-sizing:border-box;
  }
  textarea{min-height:90px;resize:vertical}
  .row{display:flex;gap:10px;align-items:center}
  .radio-group, .select-group{display:flex;gap:8px}
  .option-btn{padding:8px 12px;border-radius:8px;border:1px solid #ddd;background:#fafafa;cursor:pointer;user-select:none}
  .option-btn.active{background:var(--accent);color:#fff;border-color:rgba(0,0,0,0.08)}
  .img-preview{width:100%;height:220px;background:#f0f0f0;border-radius:8px;display:flex;align-items:center;justify-content:center;overflow:hidden}
  .img-preview img{width:100%;height:100%;object-fit:cover;display:block}
  .actions{display:flex;gap:10px;margin-top:12px}
  button{padding:10px 14px;border-radius:8px;border:none;cursor:pointer;font-weight:600}
  .btn-save{background:var(--accent);color:#fff}
  .btn-clear{background:#eee}
  .btn-whatsapp{background:var(--whatsapp);color:#fff;display:inline-flex;align-items:center;gap:8px}
  .small{font-size:12px;color:#666;margin-top:6px}
  /* responsivo */
  @media (max-width:820px){.page{grid-template-columns:1fr}}
</style>
</head>
<body>

<div class="page">
  <!-- Formul√°rio de edi√ß√£o -->
  <div class="card">
    <h1>Editar produto</h1>

    <label for="inputImage">Imagem do produto</label>
    <div class="img-preview" id="imgPreview">Nenhuma imagem</div>
    <input type="file" id="inputImage" accept="image/*" style="margin-top:8px" />

    <label for="inputName">Nome</label>
    <input type="text" id="inputName" placeholder="Ex: Pneu Aro 15" />

    <label for="inputPrice">Pre√ßo (R$)</label>
    <input type="number" id="inputPrice" placeholder="Ex: 299.90" step="0.01" min="0" />

    <label for="inputDescription">Descri√ß√£o</label>
    <textarea id="inputDescription" placeholder="Descri√ß√£o do produto"></textarea>

    <label>Tipo de compra</label>
    <div class="select-group" id="tipoCompra">
      <div class="option-btn" data-value="Varejo">Varejo</div>
      <div class="option-btn" data-value="Atacado">Atacado</div>
    </div>

    <label>Condi√ß√£o do pneu</label>
    <div class="select-group" id="condicaoPneu">
      <div class="option-btn" data-value="Novo">Novo</div>
      <div class="option-btn" data-value="Meia vida">Meia vida</div>
    </div>

    <label style="margin-top:10px"><input type="checkbox" id="inmetroCheck" /> &nbsp; Possui selo INMETRO (se aplic√°vel)</label>
    <div class="small">Marque apenas se o pneu for remoldado/recapado com certifica√ß√£o.</div>

    <div class="actions">
      <button class="btn-save" id="saveBtn">Salvar produto (local)</button>
      <button class="btn-clear" id="clearBtn">Limpar</button>
    </div>
    <div class="small" style="margin-top:8px">Os dados salvos ficar√£o no seu navegador (localStorage) e ser√£o usados na pr√©-visualiza√ß√£o / bot√£o WhatsApp.</div>
  </div>

  <!-- Pr√©-visualiza√ß√£o do produto -->
  <div class="card" id="productCard">
    <h1>Pr√©-visualiza√ß√£o</h1>
    <div id="productContainer">
      <div class="img-preview" id="productImgPreview">Nenhum produto selecionado</div>
      <h2 id="prodName" style="margin:12px 0 6px;color:#222">‚Äî</h2>
      <div id="prodPrice" style="font-weight:700;color:#111">‚Äî</div>
      <p id="prodDesc" style="color:#444">‚Äî</p>

      <p class="small"><strong>Tipo:</strong> <span id="prodTipo">‚Äî</span></p>
      <p class="small"><strong>Condi√ß√£o:</strong> <span id="prodCond">‚Äî</span> <span id="prodInmetro"></span></p>

      <div style="margin-top:14px">
        <!-- Substitua o n√∫mero abaixo pelo seu n√∫mero no formato internacional -->
        <button id="whatsappBtn" class="btn-whatsapp">üí¨ Abrir WhatsApp</button>
        <button id="downloadJson" style="margin-left:8px;padding:10px 12px;border-radius:8px;border:1px solid #ddd;background:#fff">üì• Baixar JSON</button>
      </div>
    </div>
  </div>
</div>

<script>
  // --- constantes e elementos ---
  const inputImage = document.getElementById('inputImage');
  const imgPreview = document.getElementById('imgPreview');
  const productImgPreview = document.getElementById('productImgPreview');
  const inputName = document.getElementById('inputName');
  const inputPrice = document.getElementById('inputPrice');
  const inputDescription = document.getElementById('inputDescription');
  const tipoCompraDiv = document.getElementById('tipoCompra');
  const condicaoPneuDiv = document.getElementById('condicaoPneu');
  const inmetroCheck = document.getElementById('inmetroCheck');
  const saveBtn = document.getElementById('saveBtn');
  const clearBtn = document.getElementById('clearBtn');
  const whatsappBtn = document.getElementById('whatsappBtn');
  const downloadJsonBtn = document.getElementById('downloadJson');

  const prodName = document.getElementById('prodName');
  const prodPrice = document.getElementById('prodPrice');
  const prodDesc = document.getElementById('prodDesc');
  const prodTipo = document.getElementById('prodTipo');
  const prodCond = document.getElementById('prodCond');
  const prodInmetro = document.getElementById('prodInmetro');

  // n√∫mero do WhatsApp: troque aqui (formato internacional, ex: 5511912345678)
  const phoneNumber = "SEUNUMERO";

  // --- helpers ---
  function setActiveOption(groupEl, value){
    groupEl.querySelectorAll('.option-btn').forEach(b=>{
      if(b.dataset.value === value) b.classList.add('active');
      else b.classList.remove('active');
    });
  }
  function getActiveOption(groupEl){
    return groupEl.querySelector('.option-btn.active')?.dataset.value || null;
  }

  // inicializa comportamento de sele√ß√£o para grupos
  document.querySelectorAll('.select-group').forEach(group=>{
    group.addEventListener('click', (e)=>{
      const btn = e.target.closest('.option-btn');
      if(!btn) return;
      // desmarca todos, marca o clicado
      group.querySelectorAll('.option-btn').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
    });
  });

  // upload de imagem com preview (FileReader -> dataURL)
  let currentImageDataUrl = null;
  inputImage.addEventListener('change', (e)=>{
    const file = e.target.files[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = function(ev){
      currentImageDataUrl = ev.target.result;
      imgPreview.innerHTML = `<img src="${currentImageDataUrl}" alt="Imagem" />`;
      productImgPreview.innerHTML = `<img src="${currentImageDataUrl}" alt="Imagem do produto" />`;
    };
    reader.readAsDataURL(file);
  });

  // atualizar a pr√©-visualiza√ß√£o com o objeto produto
  function renderProduct(product){
    if(!product){
      productImgPreview.innerHTML = "Nenhum produto selecionado";
      prodName.textContent = "‚Äî";
      prodPrice.textContent = "‚Äî";
      prodDesc.textContent = "‚Äî";
      prodTipo.textContent = "‚Äî";
      prodCond.textContent = "‚Äî";
      prodInmetro.textContent = "";
      return;
    }
    productImgPreview.innerHTML = product.img ? `<img src="${product.img}" alt="${product.name}" />` : "Sem imagem";
    prodName.textContent = product.name || "‚Äî";
    prodPrice.textContent = product.price ? `R$ ${Number(product.price).toFixed(2)}` : "‚Äî";
    prodDesc.textContent = product.description || "‚Äî";
    prodTipo.textContent = product.tipo || "‚Äî";
    prodCond.textContent = product.condicao || "‚Äî";
    prodInmetro.textContent = product.inmetro ? " ‚Ä¢ Possui selo INMETRO" : "";
  }

  // salvar produto no localStorage
  saveBtn.addEventListener('click', ()=>{
    const name = inputName.value.trim();
    const price = inputPrice.value;
    const description = inputDescription.value.trim();
    const tipo = getActiveOption(tipoCompraDiv) || "N√£o informado";
    const condicao = getActiveOption(condicaoPneuDiv) || "N√£o informada";
    const inmetro = inmetroCheck.checked;

    if(!name){
      alert('Preencha o nome do produto.');
      return;
    }
    if(!price){
      if(!confirm('Pre√ßo vazio. Deseja salvar mesmo assim?')) return;
    }

    // se n√£o houver imagem, usa o existente salvo ou vazio
    const imgData = currentImageDataUrl || JSON.parse(localStorage.getItem('selectedProduct'))?.img || "";

    const product = {
      name,
      price: price ? Number(price).toFixed(2) : "",
      description,
      tipo,
      condicao,
      inmetro,
      img: imgData
    };

    localStorage.setItem('selectedProduct', JSON.stringify(product));
    renderProduct(product);
    alert('Produto salvo localmente!');
  });

  // limpar formul√°rio e localStorage
  clearBtn.addEventListener('click', ()=>{
    if(!confirm('Limpar formul√°rio e remover produto salvo?')) return;
    localStorage.removeItem('selectedProduct');
    currentImageDataUrl = null;
    inputImage.value = "";
    inputName.value = "";
    inputPrice.value = "";
    inputDescription.value = "";
    inmetroCheck.checked = false;
    // desfazer sele√ß√µes visuais
    setActiveOption(tipoCompraDiv, null);
    setActiveOption(condicaoPneuDiv, null);
    renderProduct(null);
  });

  // bot√£o WhatsApp: abre conversa com mensagem preenchida
  whatsappBtn.addEventListener('click', ()=>{
    const product = JSON.parse(localStorage.getItem('selectedProduct'));
    if(!product){
      alert('Nenhum produto salvo. Preencha e clique em "Salvar produto (local)" antes de abrir o WhatsApp.');
      return;
    }
    if(phoneNumber === "SEUNUMERO"){
      if(!confirm('Voc√™ n√£o trocou o n√∫mero no c√≥digo. Deseja abrir mesmo assim?')) return;
    }
    const message = `Ol√°! Tenho interesse no produto: ${product.name || '-'}\nPre√ßo: R$ ${product.price || '-'}\nTipo: ${product.tipo || '-'}\nCondi√ß√£o: ${product.condicao || '-'}${product.inmetro ? ' (possui selo INMETRO)' : ''}\n\n${product.description || ''}`;
    const encoded = encodeURIComponent(message);
    const link = `https://wa.me/${phoneNumber}?text=${encoded}`;
    window.open(link, '_blank');
  });

  // baixar JSON do produto
  downloadJsonBtn.addEventListener('click', ()=>{
    const product = JSON.parse(localStorage.getItem('selectedProduct'));
    if(!product){ alert('Nenhum produto para baixar.'); return; }
    const blob = new Blob([JSON.stringify(product, null, 2)], {type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = (product.name || 'produto') + '.json';
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  });

  // onload: carregar produto salvo (se houver)
  window.addEventListener('load', ()=>{
    const saved = JSON.parse(localStorage.getItem('selectedProduct'));
    if(saved){
      inputName.value = saved.name || "";
      inputPrice.value = saved.price || "";
      inputDescription.value = saved.description || "";
      setActiveOption(tipoCompraDiv, saved.tipo || null);
      setActiveOption(condicaoPneuDiv, saved.condicao || null);
      inmetroCheck.checked = !!saved.inmetro;
      if(saved.img){
        currentImageDataUrl = saved.img;
        imgPreview.innerHTML = `<img src="${saved.img}" alt="Imagem" />`;
      }
      renderProduct(saved);
    } else {
      renderProduct(null);
    }
  });
</script>

</body>
</html>
