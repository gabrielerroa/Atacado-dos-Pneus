<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Produto</title>
<style>
body { font-family: Arial, sans-serif; padding:20px; background:#f5f5f5; }
.container { max-width:500px; margin:0 auto; background:#fff; padding:20px; border-radius:10px; box-shadow:0 4px 10px rgba(0,0,0,0.1); }
img { width:100%; height:auto; border-radius:10px; }
h2 { margin-top:10px; color:#333; }
p { color:#555; margin:5px 0; }
.info { font-weight:bold; margin-top:5px; }

.choice-container {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-top: 15px;
    flex-wrap: wrap;
}

.choice-btn {
    padding:10px 20px;
    border:2px solid #25D366;
    border-radius:8px;
    background:#fff;
    color:#25D366;
    font-weight:bold;
    cursor:pointer;
    transition:all 0.3s ease;
}

.choice-btn.active {
    background:#25D366;
    color:#fff;
}

button.whatsapp {
    padding:10px 20px;
    font-size:16px;
    border:none;
    border-radius:5px;
    background:#25D366;
    color:#fff;
    cursor:pointer;
    margin-top:15px;
    display:flex;
    align-items:center;
    justify-content:center;
    gap:8px;
}
button.whatsapp:hover { background:#1ebe5b; }
</style>
</head>
<body>

<div class="container" id="productContainer"></div>

<script>
const productContainer = document.getElementById('productContainer');
let product = JSON.parse(localStorage.getItem('selectedProduct'));

// Exemplo para teste local
if(!product){
    localStorage.setItem('selectedProduct', JSON.stringify({
        name: "Pneu Aro 15",
        img: "https://via.placeholder.com/400x300",
        description: "Pneu meia vida em √≥timo estado, pronto para rodar.",
        condicao: "Meia vida",
        tipo: "varejo", // pode ser "varejo", "atacado" ou ausente
        options: {
            varejo: [
                { nome:"1 unidade", quantidade:1, preco_unit:250, desconto:0 },
                { nome:"4 unidades", quantidade:4, preco_unit:240, desconto:4 }
            ],
            atacado: [
                { nome:"10 unidades", quantidade:10, preco_unit:220, desconto:12 },
                { nome:"20 unidades", quantidade:20, preco_unit:200, desconto:20 }
            ]
        }
    }));
    location.reload();
}

if(product){
    const phoneNumber = "556193995989";
    let selectedMode = "Varejo";
    let selectedOption;
    const condicao = product.condicao || "‚Äî";
    const tipo = product.tipo ? product.tipo.toLowerCase() : "ambos";

    // define modo inicial conforme tipo
    if(tipo === "atacado") selectedMode = "Atacado";
    selectedOption = (selectedMode === "Varejo" ? product.options.varejo?.[0] : product.options.atacado?.[0]) || null;

    function updateWhatsAppLink(){
        const details = [
            `Produto: ${product.name || "Sem nome"}`,
            `Modo: ${selectedMode}`,
            `Quantidade: ${selectedOption?.quantidade || 0} (${selectedOption?.nome || "?"})`,
            `Pre√ßo: R$ ${(selectedOption?.preco_unit * selectedOption?.quantidade * (1 - (selectedOption?.desconto||0)/100)).toFixed(2)}`,
            `Desconto: ${selectedOption?.desconto || 0}%`
        ].join(' | ');

        const msg = `Ol√°! Tenho interesse neste produto (${selectedMode}): ${details}. Poderia me dar mais informa√ß√µes?`;
        return `https://wa.me/${phoneNumber}?text=${encodeURIComponent(msg)}`;
    }

    function renderOptions(mode){
        const opts = mode === "Varejo" ? product.options.varejo : product.options.atacado;
        if(!opts || opts.length === 0) return `<p style="color:#999">Sem op√ß√µes dispon√≠veis.</p>`;
        return opts.map((opt,i)=>`
            <button class="choice-btn ${i===0?'active':''}" data-index="${i}">
                ${opt.nome}<br><small>${opt.desconto ? `-${opt.desconto}%` : ''}</small>
            </button>
        `).join('');
    }

    function updatePrice(){
        if(!selectedOption) return;
        const precoTotal = selectedOption.preco_unit * selectedOption.quantidade * (1 - selectedOption.desconto/100);
        document.getElementById("priceText").textContent =
            `Pre√ßo: R$ ${precoTotal.toFixed(2)} ${selectedOption.desconto>0 ? `(com ${selectedOption.desconto}% off)` : ''}`;
    }

    function renderProduct(){
        const mostrarVarejo = tipo === "varejo" || tipo === "ambos";
        const mostrarAtacado = tipo === "atacado" || tipo === "ambos";

        productContainer.innerHTML = `
            <img src="${product.img || 'https://via.placeholder.com/400x300'}" alt="${product.name || 'Produto'}">
            <h2>${product.name || 'Produto sem nome'}</h2>
            <p class="info" id="priceText"></p>
            <p class="info">Condi√ß√£o: ${condicao}</p>
            ${product.description ? `<p class="info">Descri√ß√£o: ${product.description}</p>` : ''}

            <div class="choice-container" id="modeContainer">
                ${mostrarVarejo ? `<button class="choice-btn ${selectedMode==='Varejo'?'active':''}" id="varejoBtn">Varejo</button>` : ''}
                ${mostrarAtacado ? `<button class="choice-btn ${selectedMode==='Atacado'?'active':''}" id="atacadoBtn">Atacado</button>` : ''}
            </div>

            <div class="choice-container" id="optionsContainer">
                ${renderOptions(selectedMode)}
            </div>

            <button class="whatsapp" id="whatsappBtn">üí¨ Falar no WhatsApp</button>
        `;

        const varejoBtn = document.getElementById('varejoBtn');
        const atacadoBtn = document.getElementById('atacadoBtn');
        const whatsappBtn = document.getElementById('whatsappBtn');
        const optionsContainer = document.getElementById('optionsContainer');

        function attachOptionEvents(){
            const optionButtons = document.querySelectorAll('#optionsContainer .choice-btn');
            optionButtons.forEach(btn=>{
                btn.addEventListener('click', ()=>{
                    optionButtons.forEach(b=>b.classList.remove('active'));
                    btn.classList.add('active');
                    const idx = btn.getAttribute('data-index');
                    selectedOption = selectedMode==='Varejo'
                        ? product.options.varejo[idx]
                        : product.options.atacado[idx];
                    updatePrice();
                });
            });
        }

        if(varejoBtn){
            varejoBtn.addEventListener('click', ()=>{
                selectedMode = 'Varejo';
                selectedOption = product.options.varejo[0];
                varejoBtn.classList.add('active');
                if(atacadoBtn) atacadoBtn.classList.remove('active');
                optionsContainer.innerHTML = renderOptions(selectedMode);
                attachOptionEvents();
                updatePrice();
            });
        }

        if(atacadoBtn){
            atacadoBtn.addEventListener('click', ()=>{
                selectedMode = 'Atacado';
                selectedOption = product.options.atacado[0];
                atacadoBtn.classList.add('active');
                if(varejoBtn) varejoBtn.classList.remove('active');
                optionsContainer.innerHTML = renderOptions(selectedMode);
                attachOptionEvents();
                updatePrice();
            });
        }

        attachOptionEvents();
        updatePrice();

        whatsappBtn.addEventListener('click', ()=> window.open(updateWhatsAppLink(),'_blank'));
    }

    renderProduct();
}else{
    productContainer.innerHTML = "<p>Nenhum produto selecionado.</p>";
}
</script>

</body>
</html>
